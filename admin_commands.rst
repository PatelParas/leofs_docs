.. =========================================================
.. LeoFS documentation
.. Copyright (c) 2012-2014 Rakuten, Inc.
.. http://leo-project.net/
.. =========================================================


LeoFS Administration Commands
=============================

+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **Command**                                                                          | **Description**                                                                                      |
+======================================================================================+======================================================================================================+
| **General Commands**                                                                                                                                                                        |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`status <status-command>` [<node>]                                              | * Retrieve status of every node (default)                                                            |
|                                                                                      | * Retrieve status of the specified node                                                              |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`whereis <whereis-command>` <file-path>                                         | * Retrieve an assigned object by the file-path                                                       |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **Storage Operation**                                                                                                                                                                       |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`detach <detach-command>` <storage-node>                                        | * Remove the storage node in the LeoFS storage cluster                                               |
|                                                                                      | * Current status: ``running`` | ``stop``                                                             |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`suspend <suspend-command>` <storage-node>                                      | * Suspend a storage node for maintenance                                                             |
|                                                                                      | * This command does NOT detach the node from the storage cluster                                     |
|                                                                                      | * While suspending, it rejects any requests                                                          |
|                                                                                      | * Current status: ``running``                                                                        |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`resume <resume-command>` <storage-node>                                        | * Resume a storage node for finished maintenance                                                     |
|                                                                                      | * Current status: ``suspended`` | ``restarted``                                                      |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`start <start-command>`                                                         | * Start LeoFS after distributing the RING from LeoFS Manager to LeoFS Storage and LeoFS Gateway      |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`rebalance <rebalance-command>`                                                 | * Commit detached and attached nodes to join the cluster                                             |
|                                                                                      | * Rebalance objects in the cluster based on the updated cluster topology                             |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **Recover Commands**                                                                                                                                                                        | 
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`recover file <recover-file-command>` <file-path>                               | * Recover an inconsistent object specified by the file-path                                          |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`recover node <recover-node-command>` <storage-node>                            | * Recover all inconsistent objects in the specified node                                             |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`recover ring <recover-ring-command>` <storage-node>                            | * Recover rings of the specified node                                                                |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`recover cluster <recover-cluster-command>` <cluster-id>                        | * ``v1.0.0-`` Recover all inconsistent objects in the specified cluster                              |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **Compaction Commands**                                                                                                                                                                     |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`compact start <compact-start>` <storage-node> (all | <num-of-targets>)         | * Execute to remove unnecessary objects from the node                                                |
| [<num-of-compaction-proc>]                                                           | * ``num-of-targets``: It controls the number of containers in parallel                               |
|                                                                                      | * ``num-of-compaction-procs``: It controls the number of procs to execute the compaction in parallel |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`compact suspend <compact-suspend>` <storage-node>                              | * Suspend to execute the compaction                                                                  |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`compact resume <compact-resume>` <storage-node>                                | * Resume to execute the compaction                                                                   |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`compact status <compact-status>` <storage-node>                                | * See the current compaction status                                                                  |
|                                                                                      | * Compaction's status: ``idle``, ``running``, ``suspend``                                            |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **Disk Usage**                                                                                                                                                                              |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`du <du>` <storage-node>                                                        | * See the current disk usages                                                                        |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`du detail <du-detail>` <storage-node>                                          | * See the current disk usages in the details                                                         |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **Gateway Operation**                                                                                                                                                                       |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`purge <purge>` <file-path>                                                     | * Remove the cache from each LeoFS gateway                                                           |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`remove <remove>` <gateway-node>                                                | * Remove the LeoFS gateway node, which is already stopped                                            |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **Manager Maintenance**                                                                                                                                                                     |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`backup-mnesia <backup-mnesia>` <backup-filepath>                               | * Copy LeoFS's Manager data to the filepath                                                          |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`restore-mnesia <restore-mnesia>` <backup-filepath>                             | * Restore LeoFS's Manager data from the backup file                                                  |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`update-managers <update-managers>` <manager-master> <manager-slave>            | * Update LeoFS Manager nodes                                                                         |
|                                                                                      | * Destribute the new LeoFS Manager nodes to LeoFS Storage and Gateway                                |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| :ref:`dump-ring <dump-ring>` (<manager-node>|<storage-node>|<gateway-node>)          | * Dump the ring data to the local disk                                                               |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **S3-API Commands - User**                                                                                                                                                                  |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| create-user <user-id> <password>                                                     | * Register the new user                                                                              |
|                                                                                      | * Generate an S3 key pair (AccessKeyID and SecretAccessKey)                                          |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| delete-user <user-id>                                                                | * Remove the user                                                                                    |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| get-users                                                                            | * Retrieve the list of users                                                                         |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| update-user-role                                                                     | * Update the user's role                                                                             |
|                                                                                      | * Currently, we are supporting two kinds of roles                                                    |
|                                                                                      | * 1: General user, 9: Administrator                                                                  |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **S3-API Commands - Endpoint**                                                                                                                                                              |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| add-endpoint <endpoint>                                                              | * Register a new S3 Endpoint                                                                         |
|                                                                                      | * LeoFS' domains are ruled by :ref:`this rule <s3-path-label>`                                       |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| delete-endpoint <endpoint>                                                           | * Remove the endpoint                                                                                |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| get-endpoints                                                                        | * Retrieve the list of endpoints                                                                     |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **S3-API Commands - Bucket**                                                                                                                                                                |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| add-bucket <bucket> <access-key-id>                                                  | * Create the new bucket                                                                              |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| delete-bucket <bucket> <access-key-id>                                               | * Remove the bucket and all files stored in the bucket                                               |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| get-buckets                                                                          | * Retrieve the list of the buckets registered                                                        |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| get-bucket <access-key-id>                                                           | * Retrieve the list of the buckets owned by the specified user                                       |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| chown-bucket <bucket> <access-key-id>                                                | * ``v0.16.5-`` Change the owner of the bucket                                                        |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| update-acl <bucket> <access-key-id>                                                  | * ``v0.16.0-`` Update the ACL (Access Control List) for the bucket                                   |
| (private | public-read | public-read-write)                                          | * Available ACL list:                                                                                |
|                                                                                      |      * ``private (default)`` : No one except the owner has access rights                             |
|                                                                                      |      * ``public-read``       : All users have READ access                                            |
|                                                                                      |      * ``public-read-write`` : All users have READ and WRITE access                                  |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **Multi Data Center Operation**                                                                                                                                                             |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| join-cluster <remote-manager-master> <remote-manager-slave>                          | ``1.0.0-`` Begin to communicate between the local cluster and the remote cluster                     |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| remove-cluster <remote-manager-master> <remote-manager-slave>                        | ``1.0.0-`` Terminate to communicate between the local cluster and the remote cluster                 |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| cluster-status                                                                       | ``1.0.0-`` See the current state of cluster(s)                                                       |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+

